# PRD: 반복 일정 인터벌 기능 구현

**프로젝트 ID**: PROJ-010-20251101
**작성일**: 2025-11-01
**작성자**: PM Agent
**버전**: 1.0.0

---

## 1. 개요

### 1.1 목적
반복 일정 생성 시 인터벌(간격) 설정 기능을 구현하여 사용자가 더 유연하게 반복 일정을 생성할 수 있도록 한다.

### 1.2 배경
현재 시스템은 반복 일정 생성 시 인터벌이 항상 1로 고정되어 있어, 매일/매주/매월/매년 연속적으로만 반복 일정을 생성할 수 있다. 사용자가 특정 간격으로 반복되는 일정(예: 격주 회의, 격일 운동)을 생성하려면 인터벌 설정이 필요하다.

### 1.3 목표
- 반복 일정 생성 시 인터벌 설정 기능 추가
- UI에서 인터벌 입력 필드 제공
- 인터벌에 따라 정확하게 반복 일정 생성
- 기존 기능 및 테스트 유지

---

## 2. 기능 요구사항

### 2.1 핵심 기능

#### F1. 인터벌 입력 UI
- **설명**: 반복 일정 설정 시 인터벌을 입력할 수 있는 숫자 입력 필드 제공
- **위치**: 반복 유형 선택 필드 옆 또는 아래
- **기본값**: 1
- **범위**: 1 이상의 정수
- **조건**: 반복 일정 체크박스가 선택된 경우에만 표시

#### F2. 인터벌 적용 로직
- **매일 반복 + 인터벌 N**: N일 간격으로 반복
  - 예: 1월 1일 + 인터벌 2 → 1월 1일, 1월 3일, 1월 5일, ...
- **매주 반복 + 인터벌 N**: N주 간격으로 반복
  - 예: 1월 1일 + 인터벌 2 → 1월 1일, 1월 15일, 1월 29일, ...
- **매월 반복 + 인터벌 N**: N개월 간격으로 반복
  - 예: 1월 1일 + 인터벌 2 → 1월 1일, 3월 1일, 5월 1일, ...
- **매년 반복 + 인터벌 N**: N년 간격으로 반복
  - 예: 2025년 1월 1일 + 인터벌 2 → 2025년 1월 1일, 2027년 1월 1일, ...

#### F3. 반복 일정 생성
- `generateRecurringEvents` 함수가 인터벌 파라미터를 받아 적용
- 각 반복 유형에 맞게 인터벌 배수만큼 날짜 증가
- 생성된 모든 이벤트의 `repeat.interval` 필드에 설정된 인터벌 값 저장

### 2.2 UI/UX 요구사항

#### UI1. 인터벌 입력 필드
```
[ ] 반복 일정
    [드롭다운: 매일/매주/매월/매년]
    [숫자 입력: ___] (기본값: 1, 최소값: 1)
    반복 종료일: [날짜 입력]
```

#### UI2. 입력 검증
- 인터벌은 1 이상의 양의 정수만 허용
- 0 또는 음수 입력 시 기본값 1로 자동 설정
- 소수점 입력 시 정수로 반올림

### 2.3 비기능 요구사항

#### NF1. 성능
- 인터벌 적용 시에도 반복 일정 생성 시간은 기존과 동일한 수준 유지
- 최대 1000개 이벤트 생성까지 1초 이내 완료

#### NF2. 호환성
- 기존에 생성된 반복 일정(interval=1)과 호환
- 기존 테스트 케이스 모두 통과

#### NF3. 접근성
- 인터벌 입력 필드에 적절한 label 제공
- 키보드로 입력 가능

---

## 3. 기술 요구사항

### 3.1 수정 대상 파일

1. **src/utils/recurringEventUtils.ts**
   - `generateRecurringEvents` 함수에 interval 파라미터 추가
   - 각 반복 유형에 interval 배수 적용
   - 현재: `addDays(currentDate, 1)` → 변경: `addDays(currentDate, interval)`

2. **src/hooks/useEventForm.ts**
   - repeatInterval state 확인 (이미 존재하는지 확인 필요)

3. **src/components/EventForm/EventForm.tsx**
   - 인터벌 입력 필드 UI 추가
   - repeatInterval props 전달 확인

4. **src/hooks/useEventOperations.ts**
   - generateRecurringEvents 호출 시 interval 전달

### 3.2 타입 정의
- `RepeatInfo` 타입에 interval 필드 이미 존재하는지 확인
- 필요시 타입 확장

---

## 4. 테스트 요구사항

### 4.1 단위 테스트

#### UT1. generateRecurringEvents - 매일 반복 인터벌
- 인터벌 1: 연속된 날짜
- 인터벌 2: 하루 건너뛰기
- 인터벌 7: 일주일 간격

#### UT2. generateRecurringEvents - 매주 반복 인터벌
- 인터벌 1: 매주
- 인터벌 2: 격주
- 인터벌 4: 4주 간격

#### UT3. generateRecurringEvents - 매월 반복 인터벌
- 인터벌 1: 매월
- 인터벌 2: 격월
- 인터벌 3: 분기별

#### UT4. generateRecurringEvents - 매년 반복 인터벌
- 인터벌 1: 매년
- 인터벌 2: 격년
- 인터벌 5: 5년 간격

### 4.2 통합 테스트

#### IT1. UI에서 인터벌 설정 후 반복 일정 생성
- 반복 일정 체크박스 선택
- 반복 유형 선택 (매주)
- 인터벌 2 입력
- 종료일 설정
- 일정 생성
- 예상: 격주로 일정 생성 확인

#### IT2. 인터벌 기본값 동작
- 인터벌 입력하지 않은 경우 1로 적용
- 기존 동작과 동일하게 작동

### 4.3 E2E 테스트

#### E2E1. 전체 플로우
1. 일정 추가 버튼 클릭
2. 일정 정보 입력
3. 반복 일정 설정 (매일, 인터벌 3, 종료일 30일 후)
4. 저장
5. 캘린더에서 3일 간격으로 일정 표시 확인
6. 생성된 일정 개수 확인 (약 10개)

---

## 5. 제약사항 및 고려사항

### 5.1 제약사항
- 인터벌은 1 이상의 양의 정수만 허용
- 최대 인터벌 값: 제한 없음 (단, 종료일 내에서 최소 1개 이벤트 생성 필요)
- 기존 API 인터페이스 유지 (서버측 변경 최소화)

### 5.2 엣지 케이스
1. **매월 반복 + 31일 + 인터벌 > 1**
   - 31일이 없는 달은 건너뛰기 (기존 로직 유지)

2. **매년 반복 + 2월 29일 + 인터벌 > 1**
   - 윤년이 아닌 해는 건너뛰기 (기존 로직 유지)

3. **인터벌이 매우 큰 경우**
   - 종료일 내에 이벤트가 하나도 생성되지 않을 수 있음
   - 빈 배열 반환 (정상 동작)

### 5.3 향후 확장 가능성
- 인터벌 프리셋 제공 (매일, 격일, 매주, 격주, 매월 등)
- 복합 반복 패턴 (예: 매주 월/수/금)
- 반복 종료 조건 확장 (N회 반복 후 종료)

---

## 6. 성공 기준

### 6.1 기능 완성도
- [ ] 인터벌 입력 UI 구현
- [ ] generateRecurringEvents 함수에 interval 파라미터 적용
- [ ] 4가지 반복 유형(매일/매주/매월/매년) 모두 인터벌 적용
- [ ] 생성된 이벤트에 interval 값 저장

### 6.2 테스트 통과율
- [ ] 모든 단위 테스트 통과 (100%)
- [ ] 모든 통합 테스트 통과 (100%)
- [ ] 기존 테스트 회귀 없음 (157개 테스트 유지)

### 6.3 코드 품질
- [ ] TypeScript 타입 에러 없음
- [ ] ESLint 경고 없음
- [ ] 코드 리뷰 통과

---

## 7. 일정

| 단계 | 예상 소요 시간 |
|------|---------------|
| 테스트 시나리오 설계 | 30분 |
| 테스트 코드 작성 (RED) | 1시간 |
| 기능 구현 (GREEN) | 1-2시간 |
| QA 검증 | 30분 |
| 리팩토링 | 1시간 |
| 문서화 | 30분 |
| **총 소요 시간** | **4.5-5.5시간** |

---

## 8. 참조

- 기존 구현: `src/utils/recurringEventUtils.ts`
- 타입 정의: `src/types.ts`
- 관련 컴포넌트: `src/components/EventForm/EventForm.tsx`
- 테스트 헬퍼: `src/__tests__/test-helpers/integration-helpers.tsx`

---

**승인자**: Orchestrator
**상태**: 승인됨
**다음 단계**: Test Designer (PROJ-002)
